pipeline {

    environment {
     GITHUB_API_URL='https://api.github.com/repos/kevinmenotyou/devops_assignment2'
    }
  
    agent {
        node {
            label 'test-jenkins-agent1'
        }
    }

    options {
        buildDiscarder logRotator( 
                    daysToKeepStr: '16', 
                    numToKeepStr: '10'
            )
    }


    stages {
        stage('Diagram') {
			when {
				allOf {
					changeset "diagram/*"
					not "output/*"
				}
			}
			steps {
				echo 'Building Diagram..'
				py diagram/diagram.py
				git add output/*
				git commit -m "ROBOT: Add diagram artifact to repo"
				git push
			}
        }
		stage('Building') {
		    when {
				not "output/*"
			}
            steps {
                echo 'Building..'
            }
        }
        stage('Test') {
		    when {
				not "output/*"
			}
            steps {
                echo 'Testing..'
            }
        }
        stage('Deploy') {
		    when {
			    not "output/*"
			}
            steps {
                echo 'Deploying....'
            }
        }
    }
}